<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- External dependencies (CDN) -->
  <script src="//code.jquery.com/jquery-1.12.1.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.js"></script>
  <!--<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>-->
  <!--<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment-with-locales.min.js"></script>-->
  <!-- External optional (CDN) -->
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
  <!-- Local -->
  <script src="<%= pkg.name %>.js"></script> 
  <script src="moment-localized.min.js"></script> <!-- bundle with a subset of locales --> 
  <link rel="stylesheet" href="fonts.css"/>
  <link rel="stylesheet" href="style.css"/>

  <style>
    .page {
        margin: 25px 15px;
        font-size: 16px;    
    }
    .nav {
        border-bottom: solid 2px #337AB7;
    }
    .nav > li {
        font-size: 1.4em;
        font-weight: bold;
        border-radius: 1px;
    }
    .nav > li > a {
        border-radius: 1px;
    }
  </style>
</head>

<body>
 
 <div class="page container-fluid"> 
   <div class="row">
      <div class="col-md-9">
        <ul class="nav nav-pills">
          <li class="active"><a data-toggle="pill" href="#meter-charts-tab">Meter Charts</a></li>
          <li class=""><a data-toggle="pill" href="#b1-charts-tab">B1 Charts</a></li>
        </ul> <!-- .nav -->
 
        <div class="tab-content">
          
          <!-- Meter Charts -->
          <div id="meter-charts-tab" class="tab-pane in active">
            <h3>Day View</h3>
            <div class="chart" id="meter-chart-day-view"></div>

            <h3>Week View</h3>
            <div class="chart" id="meter-chart-week-view"></div>

            <h3>Month View</h3>
            <div class="chart" id="meter-chart-month-view"></div>

            <h3>Year View</h3>
            <div class="chart" id="meter-chart-year-view"></div>
          </div> <!-- #meter-charts-tab -->

          <!-- B1 Charts -->
          <div id="b1-charts-tab" class="tab-pane">
            <h3>Todo B1 ...</h3>
         </div> <!-- #b1-charts-tab -->

       </div> <!-- .tab-content -->

      </div> <!-- column -->
    </div> <!-- row -->
  </div>
  
</body>

<script type="text/javascript">
    $(document).ready(function () {
        
        var charts = daiad.charts;
        var Measurement = daiad.model.Measurement;

        console.info(daiad.VERSION);
                
        var data = null;
        
        var qs = new Map($.map(
            window.location.search.replace(/^[?]/, '').split('&'),
            function (v) { return [v.split('=')]}))
        var locale = qs.get('locale') || 'en'
        moment.locale(locale);
        console.info('Using locale: ' + locale);


        //
        // Day
        //

        function getDataForDay(miny, maxy, resolution) {
            var dy = maxy - miny;
            var now = moment(), t0 = moment().startOf('day');
            var num_points = (24 / resolution);
            return $.map(new Array(num_points), function(_, i) {
                var t = t0.clone().add(i * resolution, 'hour');
                var val = miny + Math.random() * dy
                return new Measurement(i, t.toDate(), val);
            });
        }
        
        var levels = [
            {
                range: [50, 80],
                color: '#6976EB',
                description: 'Low',
            },
            {
                range: [80, 120],
                color: '#3843A5',
                description: 'Mid',
            },
            {
                range: [120, 160],
                color: '#2D3580',
                description: 'High',
            },
            {
                range: [160, 200],
                color: '#2F3565',
                description: 'Very High',
            },
        ]

        data = getDataForDay(50, 200, 1); 
        charts.meter.plotForDay($('#meter-chart-day-view'), data, {
            resolution: 1, // hours
            levels: levels,
        });

        //
        // Week
        //

        function getDataForWeek(miny, maxy, resolution) {
            var dy = maxy - miny;
            var now = moment(), t0 = moment().startOf('isoweek');
            var num_points = Math.ceil(7 / resolution);
            return $.map(new Array(num_points), function(_, i) {
                var t = t0.clone().add(i * resolution, 'day');
                var val = miny + Math.random() * dy
                return new Measurement(i, t.toDate(), val);
            });
        }

        data = getDataForWeek(50, 200, 1);
        charts.meter.plotForWeek($('#meter-chart-week-view'), data, {
            resolution: 1, // days
            levels: null,
        });

        //
        // Month
        //

        function getDataForMonth(miny, maxy, resolution) {
            var dy = maxy - miny;
            var now = moment(), t0 = moment().startOf('month');
            var num_points = Math.ceil(t0.daysInMonth() / resolution);
            return $.map(new Array(num_points), function(_, i) {
                var t = t0.clone().add(i * resolution, 'day');
                var val = miny + Math.random() * dy
                return new Measurement(i, t.toDate(), val);
            });
        }
        
        data = getDataForMonth(50, 200, 2);
        charts.meter.plotForMonth($('#meter-chart-month-view'), data, {
            resolution: 2, // days
        });

        //
        // Year
        //

        function getDataForYear(miny, maxy, resolution) {
            var dy = maxy - miny;
            var now = moment(), t0 = moment().startOf('year');
            var num_points = Math.ceil(12 / resolution);
            return $.map(new Array(num_points), function(_, i) {
                var t = t0.clone().add(i * resolution, 'month');
                var val = miny + Math.random() * dy
                return new Measurement(i, t.toDate(), val);
            });
        }
        
        data = getDataForYear(50, 200, 1);
        charts.meter.plotForYear($('#meter-chart-year-view'), data, {
            resolution: 1, // months
        });

    })
</script>

</html>
